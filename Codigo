import pandas as pd
import os

class AlmacenarResultados:
    def __init__(self):
        self.mejor_auge = []
        self.mejor_estabilidad = []
        self.mejoras_significativas = []

    def añadir_mejora_significativa(self, df, cambio):
        mejora_significativa = False
        descripcion = ""
        if cambio > 100 or (df["market_cap"].iloc[-1] - df["market_cap"].iloc[0]) > 100000000:
            mejora_significativa = True
            if cambio > 100:
                descripcion += "Aumento del precio del " + str(round(cambio, 2)) + "%."
            if (df["market_cap"].iloc[-1] - df["market_cap"].iloc[0]) > 100000000:
                if descripcion != "": descripcion += " Y "
                descripcion += "Aumento de la capitalización de mercado en $" + str(round((df["market_cap"].iloc[-1] - df["market_cap"].iloc[0]) / 1000000, 2)) + " millones."

        if mejora_significativa:
            self.mejoras_significativas.append({"nombre": df["nombre"].iloc[0], "mejora": descripcion})

    def ordenar_resultados(self):
        self.mejor_auge.sort(key=lambda x: x["cambio"], reverse=True)
        self.mejor_estabilidad.sort(key=lambda x: x["desviacion_estandar"])

    def calcular_cambio(self, precio_inicial, precio_final):
        return ((precio_final - precio_inicial) / precio_inicial) * 100

    def calcular_desviacion_estandar(self, precios):
        return precios.std()
